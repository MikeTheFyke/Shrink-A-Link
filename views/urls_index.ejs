<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
			integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
			crossorigin="anonymous"
		/>
		<title><%= dictionary.common.shrinkALink %></title>
	</head>
	<body>
		<%- include('partials/_header') %>
		<main style="margin: 1em 0 1em 0">
			<h3
				style="padding-left: 14px; background-color: #17a2b8; color: white; width: 150px; border-top-right-radius: 10px; margin-bottom: 0"
			>
				<%= dictionary.common.yourLinks %>
			</h3>
			<table class="table table-striped" style="table-layout: fixed">
				<thead>
					<tr>
						<th scope="col" style="width: 20%"><%= dictionary.common.shortURL %></th>
						<th scope="col" style="max-width: 300px"><%= dictionary.common.longURL %></th>
						<th scope="col"></th>
					</tr>
				</thead>
				<tbody>
					<% for (let id in urls) { %>
					<tr>
						<form method="POST" action="/urls/<%= id %>/delete">
							<td style="padding-left: 14px; padding-top: 18px; width: 20%">
								<a target="_blank" href="<%= urls[id] %>"><%= id %></a>
							</td>
							<td style="padding-top: 18px; max-width: 300px; overflow: hidden; text-overflow: ellipsis">
								<a style="width: 300px" target="_blank" href="<%= urls[id] %>"><%= urls[id] %></a>
							</td>
							<td>
								<button type="button" class="btn btn-info">
									<a href="/urls/<%= id %>" style="text-decoration: none; color: white"><%= dictionary.common.edit %></a>
								</button>
								<button type="submit" class="btn btn-danger"><%= dictionary.common.delete %></button>
								<button type="button" data-target="<%= id %>" class="btn btn-primary" onclick="openModal(`<%= id %>`, `<%= urls[id] %>`)">
									<%= dictionary.common.edit %>
								</button>
							</td>
						</form>
					</tr>
					<div
						id="modal-overlay"
						style="
							display: none;
							position: fixed;
							z-index: -100;
							padding-top: 100px;
							left: 0;
							top: 0;
							width: 100%;
							height: 100%;
							overflow: auto;
							background-color: rgb(0, 0, 0);
							background-color: rgba(0, 0, 0, 0.4);
						"
					>
						<dialog data-modal style="border: 0px solid #6c757d; border-radius: 15px; box-shadow: 0 5px 10px #6c757d">
							<div style="display: flex; justify-content: space-between">
								<h3 class="card-title"><%= dictionary.common.editALink %></h3>
								<button
									onclick="closeModal()"
									style="
										color: white;
										background-color: #6c757d;
										border: none;
										outline: inherit;
										cursor: pointer;
										font-size: 28px;
										line-height: 26px;
										width: 28px;
										height: 28px;
										border-radius: 14px;
										display: inline-flex;
										text-align: center;
										padding-left: 5px;
									"
								>
									X
								</button>
							</div>
							<form method="POST" action="/urls/<%= id %>">
								<label for="longURL"><%= dictionary.common.newLink %></label>
								<input name="longURL" id="longURL" placeholder="http://" style="width: 100%; margin-bottom: 10px" autocomplete="off" />
								<button type="submit" class="btn btn-info btn-block" style="margin-bottom: 2px"><%= dictionary.common.submit %></button>
							</form>
						</dialog>
					</div>
					<% } %>
				</tbody>
			</table>
		</main>
		<!-- Bootstrap JS -->
		<script
			src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
			integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
			crossorigin="anonymous"
		></script>
		<script
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
			integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
			crossorigin="anonymous"
		></script>
		<script>
			// const openButton = document.querySelector("[data-open-modal]");
			const closeButton = document.querySelector("[data-close-modal]");
			const modal = document.querySelector("[data-modal]");

			// openButton.addEventListener("click", (e, id) => {
			// 	console.log("ID : ", id);
			// 	modal.show();
			// });

			// closeButton.addEventListener("click", () => {
			// 	console.log("Close");
			// 	modal.close();
			// });

			const openModal = (id, url) => {
				document.getElementById("modal-overlay").style.display = "block";
				document.getElementById("modal-overlay").style.zIndex = "10";
				modal.show();
			};

			const closeModal = () => {
				document.getElementById("modal-overlay").style.display = "none";
				document.getElementById("modal-overlay").style.zIndex = "-100";
				modal.close();
			};
		</script>
	</body>
</html>
